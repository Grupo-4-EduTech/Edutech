<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/CssDashProfessor/Dashgeral.css">
    <link rel="stylesheet" href="../css/CssDashProfessor/Alunos.css">
    <link rel="icon" sizes="56X56" href="../assets/a 1logo-Educare.svg">
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Edu Tech | Dashboard</title>
</head>

<body onload="selecionarOrdemExibicao()">

    <div class="modalSuporte" onclick="fecharmodal()">
        <div class="contentSuporte">
            <div class="titleSuporte">Meios de contato</div>
            <div class="EspacoModalSuporte"></div>
            <div class="titleSuporte">
                <a href="https://wa.me/+5511914821813" target="_blank">
                    <img src="../assets/Icon-whatsapp.png" class="iconsModal">
                </a>
                <a href="https://www.instagram.com/theodorsouza42/?next=%2Fbluegodzi%2Ftagged%2F&locale=在
                    线定制塔吉克斯坦TEF证书联系%7B威信%2BTG%2F飞机%3A%40buth2788%7DsjwNH%3F%3F%3F%3F%3F%3Fѧ%3F%3FƾSwQuO"
                    target="_blank">
                    <img src="../assets/icon_insta.webp" class="iconsModal" id="Insta">
                </a>
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=samukatsouza16@gmail.com&su=
Necessito%20De%20apoio%20com%20a%20tela%20de%20Alunos!&body=Mensagem%20.%20.%20." target="_blank">
                    <img src="../assets/icon_gmail.svg" class="iconsModal" id="google">
                </a>
            </div>
        </div>
    </div>
    <div class="menuLateral">
        <div class="logoEduTech"></div>
        <div class="navegacaoTitulo">
            <span>
                Navegação
            </span>
        </div>
        <div class="containerNavegacao">
            <div class="fileiraSelecionada" onclick="gotoTurmas()">
                <div class="imgFileira">
                    <img src="../assets/chapeuBranco.svg"  width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Turmas
                </div>
            </div>
            <div class="fileiraNavegacao">
                <div class="imgFileira">
                    <img src="../assets/descritores.svg" width="23px" height="23px">
                </div>
                <div class="tituloFileira" onclick="gotoMatrizReferencia()">
                    Descritores
                </div>
            </div>
            <div class="fileiraNavegacao">
                <div class="imgFileira">
                    <img src="../assets/bx_support.svg" width="30px" height="30px">
                </div>
                <div class="tituloFileira" onclick="abrirSuporte()">
                    Suporte
                </div>
            </div>
        </div>
        <div class="exit" onclick="SairDaDash()">
            <img src="../assets/sair.svg">
            <span>
                Sair
            </span>
        </div>
    </div>
    <div class="Areadash">
        <div class="AreaKPI" id="areaKPI">
            <div class="KPI">
                <div class="AreaIconLocal">
                    <img src="../assets/IconPessoa.svg" class="IconLocalSelecionadoKPI">
                </div>
                <div class="AreaTextoLocal">
                    <div class="TextoLocal">
                        Alunos
                    </div>
                    <div class="EspacoTextoLocal">
                        |
                    </div>
                    <div class="AreaTextoLocalSelecionado" id="id_turma">

                    </div>
                </div>
                <div class="EspacoKPI">
                </div>
                <div class="AreaSinoNotificacao">
                    <img src="../assets/sinonotificacaoturma.svg" class="SinoNotificacao">
                </div>
                <div class="AreaEspacoNotificacao">
                    <div class="EspacoNotificacao">
                    </div>
                </div>
                <div class="AreaSobreUsuario">
                    <div class="AreaPrincipalFoto">
                        <div class="AreaSecundariaFoto">
                            <img src="../assets/fotousuarioturma.svg" class="FotoDoUsuario">
                        </div>
                    </div>
                    <div class="AreaDadosDoUsuario">
                        <div class="NomeDoUsuario" id="nome_usuario">Usuário</div>
                        <div class="CargoDoUsuario" id="cargo_usuario">Professor(a)</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="AreaDeTrabalho" id="AreaDetrabalhoAlunos">
            <div class="AreaDePesquisa">
                <div class="AbasDePesquisa" id="Aba1">
                    <div class="AreaFiltros" id="AreaPesquisar">
                        Pesquisar
                        <div class="SubDiv">
                            <input id="InputDePesquisa">
                            <button id="AplicarFiltros" onclick="pesquisarAluno()">
                                <img src="../assets/LupaSimplesAluno.svg" class="LupaSimplesAluno">
                            </button>
                        </div>
                    </div>
                </div>
                <div class="AbasDePesquisa" id="Aba2">
                    <div class="AreaFiltros" id="AreaFiltrar">
                        <span>Ordenar por: </span>
                        <select id="SelecaoDeFiltros" onclick="selecionarOrdemExibicao()">
                            <option value="1">Proficiência (Crescente)</option>
                            <option value="2">Proficiência (Decrescente)</option>
                            <option value="3">Ordem alfabética</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="AreaTrabalhoAlunos" id="div_pai_alunos">
           
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script src="../js/sessao.js"></script>
<script>
     function gotoMatrizReferencia(){
        var url = "https://download.inep.gov.br/educacao_basica/saeb/matriz-de-referencia-de-matematica_2001.pdf";
        window.open(url, '_blank');
    }

    function abrirModais(codigoModal) {
        let listamodais = ['.modalSuporte']
        const modal1 = document.querySelector(listamodais[codigoModal])
        modal1.style.display = 'block'
    }
    function abrirSuporte() {
        let codigoModal = 0
        abrirModais(codigoModal);
    }

    function fecharmodal(codigoModal) {
        let listamodais = ['.modalSuporte']
        for (let i = 0; i <= listamodais.length; i++) {
            let modal1 = document.querySelector(listamodais[i])
            modal1.style.display = 'none'
        }
    }
  
function gotoTurmas(){
        window.location.href = "EntradaDash.html"   
    }

    const idUsuario = sessionStorage.getItem('ID_USUARIO');
    const cargoUsuario = sessionStorage.getItem('CARGO_USUARIO');
    const nomeUsuario = sessionStorage.getItem('NOME_USUARIO');

    nome_usuario.innerHTML = nomeUsuario;
    cargo_usuario.innerHTML = cargoUsuario;

    const idTurmaSelecionada = sessionStorage.getItem('ID_TURMA')
    id_turma.innerHTML = "Turma: " + idTurmaSelecionada;
    const idMateria = sessionStorage.getItem('ID_MATERIA');


    function selecionarOrdemExibicao(){
        let ordenacao = idMateria == 1 ? "mediaMT" : "mediaLP"

        const selectOrdenacao = SelecaoDeFiltros.value;

        if(selectOrdenacao == 2){
            ordenacao += " DESC"; 
        }
        else if(selectOrdenacao == 3){
            ordenacao = "a.nome";
        }
        
        listarAlunosIndividualmente(ordenacao);
    }

    // const ordenacaoFiltrada = selecionarOrdemExibicao()
    // listarAlunosIndividualmente(ordenacaoFiltrada);
   

    function listarAlunosIndividualmente(ordenacao) {
        fetch(`/dashboardProfessor/listarAlunosIndividualmente/${idMateria}/${idTurmaSelecionada}/${ordenacao}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }           
                resposta.json().then(function (resposta) {
                    let contadorFileira = 0;
                    let fileira = 0;
                    let a = 0;
                    div_pai_alunos.innerHTML = ""
                    for (let i = 0; i < resposta.length; i++) {
                        let aluno = resposta[i];
                        id_turma.innerHTML = aluno.nomeTurma;
                        
                        let media = idMateria == 1 ? aluno.mediaMT : aluno.mediaLP;
                        const dificuldadeAluno = verificarDificuldadePorDescritor(aluno.dificuldade, idMateria);
                       
                        if(fileira == 0){
                            div_pai_alunos.innerHTML += `
                                    <div class="FileiraAlunos" id="fileira${contadorFileira}">
                                    </div>
                                `;
                           a = contadorFileira;
                            contadorFileira++;
                        }
                        
                        
                            const idFileira = document.getElementById(`fileira${a}`)
                            console.log()
                                idFileira.innerHTML += `
                                <div class="AreaInfoAlunoEnglobado">
                                    <div class="AreaImagemAluno">
                                        <div class="ImagemAluno">
                                            <img src="../assets/IconAluno.svg" id="ImagemAluno">
                                        </div>
                                    </div>
                                    <div class="AreaNomeDoAluno" id="div_nome_aluno">
                                        ${aluno.nome}
                                    </div>
                                    <div class="AreaProeficiencia">
                                        <div class="AreaImagem">
                                            <img src="../assets/IconLivroProeficiencia.svg">
                                        </div>
                                        <div class="AreaTexto" id="div_proficiencia_aluno">
                                            Proficiência: <b>${media}</b>
                                        </div>
                                    </div>
                                    <div class="AreaProeficiencia">
                                        <div class="AreaImagem">
                                            <img src="../assets/IconAlertaBlueskin.svg">
                                        </div>
                                        <div class="AreaTexto" id="div_dificuldade">
                                            ${dificuldadeAluno}
                                        </div>
                                    </div>
                                </div>
                            `;
                            fileira++;

                        if(fileira == 3){
                                fileira = 0;
                        }
                            
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }


    function verificarDificuldadePorDescritor(descritor, materia) {
        let dificuldadeTurma = 'Nenhum';

        if (materia == 1) {
            if (descritor == 'D1' || descritor == 'D2' || descritor == 'D3' || descritor == 'D4' || descritor == 'D5' || descritor == 'D6' || descritor == 'D' || descritor == 'D8' || descritor == 'D9' || descritor == 'D10') {
                dificuldadeTurma = 'Espaço e Forma';
            }
            else if (descritor == 'D11' || descritor == 'D12' || descritor == 'D13') {
                dificuldadeTurma = 'Grandezas e Medidas';
            }
            else if (descritor == 'D14' || descritor == 'D15' || descritor == 'D16' || descritor == 'D17' || descritor == 'D18' || descritor == 'D19' || descritor == 'D20' || descritor == 'D21' || descritor == 'D22' || descritor == 'D23' || descritor == 'D24' || descritor == 'D25' || descritor == 'D26' || descritor == 'D27' || descritor == 'D28' || descritor == 'D29' || descritor == 'D30' || descritor == 'D31' || descritor == 'D32' || descritor == 'D33') {
                dificuldadeTurma = 'Álgebra e Funções';
            }
            else if (descritor == 'D34' || descritor == 'D35') {
                dificuldadeTurma = 'Tratamento da Informação';
            }
        }
        else if (materia == 2) {
            if (descritor == 'D1' || descritor == 'D3' || descritor == 'D4' || descritor == 'D6' || descritor == 'D14') {
                dificuldadeTurma = 'Procedimentos de leitura';
            }
            else if (descritor == 'D5' || descritor == '12') {
                dificuldadeTurma = 'Compreensão do texto';
            }
            else if (descritor == 'D20' || descritor == 'D21') {
                dificuldadeTurma = 'Relação entre textos';
            }
            else if (descritor == 'D2' || descritor == 'D7' || descritor == 'D8' || descritor == 'D9' || descritor == 'D10' || descritor == 'D11' || descritor == 'D15') {
                dificuldadeTurma = 'Coerência e coesão';
            }
            else if (descritor == 'D16' || descritor == 'D17' || descritor == 'D18' || descritor == 'D19') {
                dificuldadeTurma = 'Relações entre recursos';
            }
            else if (descritor == 'D13') {
                dificuldadeTurma = 'Variação linguística';
            }
        }


        return dificuldadeTurma;
    }
    

    function pesquisarAluno(){
        const pesquisa = InputDePesquisa.value;

        fetch(`/dashboardProfessor/pesquisarAluno/${idMateria}/${idTurmaSelecionada}/${pesquisa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    throw "Nenhum resultado encontrado!!";
                }           
                resposta.json().then(function (resposta) {
                    let contadorFileira = 0;
                    let fileira = 0;
                    let a = 0;
                    div_pai_alunos.innerHTML = ""
                    for (let i = 0; i < resposta.length; i++) {
                        let aluno = resposta[i];

                        let media = idMateria == 1 ? aluno.mediaMT : aluno.mediaLP;
                        const dificuldadeAluno = verificarDificuldadePorDescritor(aluno.dificuldade, idMateria);
                       
                        if(fileira == 0){
                            div_pai_alunos.innerHTML += `
                                    <div class="FileiraAlunos" id="fileira${contadorFileira}">
                                    </div>
                                `;
                           a = contadorFileira;
                            contadorFileira++;
                        }
                        
                        
                            const idFileira = document.getElementById(`fileira${a}`)
                            console.log()
                                idFileira.innerHTML += `
                                <div class="AreaInfoAlunoEnglobado">
                                    <div class="AreaImagemAluno">
                                        <div class="ImagemAluno">
                                            <img src="../assets/IconAluno.svg" id="ImagemAluno">
                                        </div>
                                    </div>
                                    <div class="AreaNomeDoAluno" id="div_nome_aluno">
                                        ${aluno.nome}
                                    </div>
                                    <div class="AreaProeficiencia">
                                        <div class="AreaImagem">
                                            <img src="../assets/IconLivroProeficiencia.svg">
                                        </div>
                                        <div class="AreaTexto" id="div_proficiencia_aluno">
                                            Proficiência: <b>${media}</b>
                                        </div>
                                    </div>
                                    <div class="AreaProeficiencia">
                                        <div class="AreaImagem">
                                            <img src="../assets/IconAlertaBlueskin.svg">
                                        </div>
                                        <div class="AreaTexto" id="div_dificuldade">
                                            ${dificuldadeAluno}
                                        </div>
                                    </div>
                                </div>
                            `;
                            fileira++;

                        if(fileira == 3){
                                fileira = 0;
                        }
                            
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

    function SairDaDash(){
        limparSessao();
        window.location.href = "../index.html"
    }
</script>