<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/cssDashSecretaria/inicioSecrretaria.css">
    <link rel="stylesheet" href="../css/cssDashSecretaria/cadastro-diretores.css">
    <link rel="icon" sizes="56X56" href="../assets/a 1logo-Educare.svg">
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet'>
    <title>Edu Tech | Dashboard</title>
</head>

<body onload="validarSessao(), escolasSemDiretor(), diretor()">

    <div class="modalSuporte" onclick="fecharmodal()">
        <div class="contentSuporte">
            <div class="titleSuporte">Meios de contato</div>
            <div class="EspacoModalSuporte"></div>
            <div class="titleSuporte">
                <a href="https://wa.me/+5511914821813"  target="_blank">
                    <img src="../assets/Icon-whatsapp.png" class="iconsModal">
                </a>
                <a
                    href="https://www.instagram.com/theodorsouza42/?next=%2Fbluegodzi%2Ftagged%2F&locale=在
                    线定制塔吉克斯坦TEF证书联系%7B威信%2BTG%2F飞机%3A%40buth2788%7DsjwNH%3F%3F%3F%3F%3F%3Fѧ%3F%3FƾSwQuO"  target="_blank">
                    <img src="../assets/icon_insta.webp" class="iconsModal" id="Insta">
                </a>
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=samukatsouza16@gmail.com&su=
Necessito%20De%20apoio%20com%20a%20tela%20de%20Alunos!&body=Mensagem%20.%20.%20."  target="_blank">
                    <img src="../assets/icon_gmail.svg" class="iconsModal" id="google">
                </a>
            </div>
        </div>
    </div>

    <div class="menuLateral">
        <div class="logoEduTech"></div>
        <div class="navegacaoTitulo">
            <span>
                Navegação
            </span>
        </div>
        <div class="containerNavegacao">
            <div class="fileiraSelecionada" onclick="mudarTelaDiretor()">
                <div class="imgFileira">
                    <img src="../assets/maletaLateral.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Diretores
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaEscola()">
                <div class="imgFileira">
                    <img src="../assets/escolaLateral.svg"  width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Escolas
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaDashboard()">
                <div class="imgFileira">
                    <img src="../assets/mdi_graph-box.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Dashboard
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaDescritores()">
                <div class="imgFileira">
                    <img src="../assets/descritores.svg" width="23px" height="23px">
                </div>
                <div class="tituloFileira">
                    Descritores
                </div>
            </div>
            <div class="fileiraNavegacao">
                <div class="imgFileira">
                    <img src="../assets/bx_support.svg" width="30px" height="30px">
                </div>
                <div class="tituloFileira" onclick="abrirSuporte()">
                    Suporte
                </div>
            </div>
        </div>
        <div class="exit" onclick="SairDaDash()">
            <img src="../assets/sair.svg">
            <span>
                Sair
            </span>
        </div>
    </div>

    <div class="areaProfessores">
        <div class="kpi">
            <div class="kpiProfessor">
                <div class="kpi_esquerda">
                    <img src="../assets/maletaLateral.svg" class="imgem_kpi">
                    <span class="titulo_kpi">Diretores</span>
                </div>
                <div class="kpi_direita">
                    <img src="../assets/sino.svg" class="icone_notificacao" id="sino_alerts">
                    <span class="bolinha-notificacao" id="bolinha_vermelha"></span>
                    <img src="../assets/linha-kpi.svg" class="barra_kpi">
                    <img src="../assets/icone_usuario.svg" class="icone_usuario">
                    <div class="nome_titulo">
                        <p class="kpi_nomeUsuario" id="nomeUsuario">Usuario Sobrenome</p>
                        <h6 class="kpi_descricao">Secretaria da educação</h6>
                    </div>
                </div>

            </div>
        </div>

        <!-- ALERTAS -->
        <div class="wrapper" id="wra">
            <div class="triangle"></div>
            <div class="base" id="basesinha">
            </div>
        </div>

        <div class="area_cadastro">

            <div class="form_cadastro">
                <div class="titulo_cadastro">
                    <h1>Edição de Diretores</h1>
                </div>
                <!-- <div class="sessao_nome">
                    <span><b>Nome</b></span>
                    <input type="text" placeholder="Nome">
                </div> -->
                <div class="sesssao_regiao_cidade">
                    <div class="sessao_regiao">
                        <span><b>Nome</b></span>
                        <input type="text" placeholder="Nome" id="nome">
                    </div>
                    <div class="sessao_cidade">

                        <span><b>Sobrenome</b></span>
                        <input type="text" placeholder="Sobrenome" id="sobrenome">
                    </div>
                </div>


                <div class="sessao_logradouro_numero">
                    <div class="sessao_logradouro">
                        <span ><b>email</b></span>
                        <input type="email" placeholder="Email" id="email">

                    </div>
                    <div class="sessao_telefone">

                        <span><b>Telefone</b></span>
                        <input type="text" inputmode="numeric" placeholder="(XX) XXXXX - XXXX" id="telefone" maxlength="11">
                    </div>
                </div>
                <div class="sessao_logradouro_numero">
                    <div class="select_Instituicao">
                        <span><b>Instituição</b></span>
                        <select class="Instituicao" id="instituicao">
                            <option value="">Selecione a Instituição</option>
                        </select>
                </div>
                </div>
                    
                <div class="botao_cadastrar">
                        <button type="submit" onclick="editarModal()">Editar</button>
                </div>
            </div>
        </div>
    </div>
    <dialog close id="modalEditar">
        <div id="textoModalExcluir">Tem certeza que deseja editar esse diretor?</div>
        <div style="display: flex; justify-content: end; gap: 10px; margin: 5px 5px;">
            <button id="cancelarEditar" onclick="cancelarEditar()">Cancelar</button>
            <button id="confirmarEditar" onclick="confirmarEditar()">Editar</button>
        </div>
    </dialog>
</body>

</html>

<script src="../js/sessao.js"></script>

<script>
    function mudarTelaDiretor() {
        window.location = "lista-Diretores.html"
    }
    function mudarTelaEscola() {
         window.location = "Dash-Secretaria.html"
    }
    function mudarTelaDashboard() {
        window.location = "dashbord-Escolas.html"
    }
    function mudarTelaDescritores() {
        window.open('https://download.inep.gov.br/publicacoes/institucionais/avaliacoes_e_exames_da_educacao_basica/matriz_de_referencia_de_lingua_portuguesa_e_matematica_do_saeb.pdf')
    }

    function SairDaDash(){
    limparSessao();
    window.location.href = "../index.html"
}

function abrirModais(codigoModal) {
    let listamodais = ['.modalSuporte']
    const modal1 = document.querySelector(listamodais[codigoModal])
    modal1.style.display = 'block'
}
function abrirSuporte() { 
    let codigoModal = 0
    abrirModais(codigoModal);
}

function fecharmodal(codigoModal){
 let listamodais = ['.modalSuporte']
        for(let i = 0;i <=listamodais.length;i++) {  
            let modal1 = document.querySelector(listamodais[i])
            modal1.style.display = 'none'
    }
}

function escolasSemDiretor() {
    fetch("/secretaria/escolasSemDiretor", {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((escolas) => {
            escolas.forEach((escola) => {
                instituicao.innerHTML += `<option value=${escola.idEscola}>${escola.nome}</option>`
            })
        })
    })
}

function diretor(){
    let params = new URLSearchParams(document.location.search);
    let idUsuario = params.get("idDiretor");
    fetch(`/secretaria/diretor/${idUsuario}`, {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((diretor) => {
            nomeDiretor = diretor[0].nomeDiretor.substr(0,diretor[0].nomeDiretor.indexOf(" "));
            sobrenomeDiretor = diretor[0].nomeDiretor.substr(diretor[0].nomeDiretor.indexOf(" ")).trim();
            nome.value = nomeDiretor;
            sobrenome.value = sobrenomeDiretor;
            email.value = diretor[0].email;
            telefone.value = diretor[0].telefone;
            instituicao.innerHTML += `<option value=${diretor[0].fkEscola}>${diretor[0].nomeEscola}</option>`
            instituicao.value = diretor[0].fkEscola;
        })
    })
}

function editarModal() {
    modalEditar.showModal();
}

function cancelarEditar() {
    modalEditar.close();
}

function confirmarEditar() {
    let nomeVar = nome.value;
    let sobrenomeVar = sobrenome.value;
    let emailVar = email.value;
    let telefoneVar = telefone.value;
    let instituicaoVar = instituicao.value;

    if (!nomeVar||!sobrenomeVar||!emailVar||!telefoneVar||instituicaoVar==0) {
        alert("Preencha todos os campos");
    } else {
        modalEditar.innerHTML = "<span>Insira sua senha para confirmar</span><br><input id='senhaConfirmar' type='password'><button onclick='editarDiretor()'>Confirmar</button>"
    }
}

function editarDiretor(){
    let nomeVar = nome.value;
    let sobrenomeVar = sobrenome.value;
    let emailVar = email.value;
    let telefoneVar = telefone.value;
    let instituicaoVar = instituicao.value;
    let params = new URLSearchParams(document.location.search);
    let idUsuario = params.get("idDiretor");
    let senha = senhaConfirmar.value;
    
    fetch(`/secretaria/confirmarOperacao/${sessionStorage.ID_USUARIO}/${senha}`, {
        method: "GET",
    }).then(function (resposta) {
        if (resposta.ok) {
            fetch(`/secretaria/editarDiretor/${idUsuario}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    nomeServer: nomeVar+" "+sobrenomeVar,
                    emailServer: emailVar,
                    telefoneServer: telefoneVar,
                    instituicaoServer: instituicaoVar
                    
                }),
            }).then(function (resposta) {
                if (resposta.ok) {
                    alert("Diretor editado com sucesso");
                    mudarTelaDiretor();
                    return resposta.json();
                } else { throw "Houve um erro ao tentar realizar a edição!" }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        } else {
            alert("Falha em validar usuário.")
        }
    });
}

</script>

<script src="../js/alerta.js"></script>