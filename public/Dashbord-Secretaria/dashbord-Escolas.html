<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/cssDashSecretaria/inicioSecrretaria.css">
    <link rel="stylesheet" href="../css/cssDashSecretaria/dashbord-escolas.css">
    <link rel="stylesheet" href="../css/alertas.css">
    <link rel="icon" sizes="56X56" href="../assets/a 1logo-Educare.svg">
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Edu Tech | Dashboard</title>
</head>
<body onload="validarSessao(), medias(), abaixoMedia(), comparacaoRegiao(), rankingEscolas()">
    <div class="modalSuporte" onclick="fecharmodal()">
        <div class="contentSuporte">
            <div class="titleSuporte">Meios de contato</div>
            <div class="EspacoModalSuporte"></div>
            <div class="titleSuporte">
                <a href="https://wa.me/+5511914821813"  target="_blank">
                    <img src="../assets/Icon-whatsapp.png" class="iconsModal">
                </a>
                <a
                    href="https://www.instagram.com/theodorsouza42/?next=%2Fbluegodzi%2Ftagged%2F&locale=在
                    线定制塔吉克斯坦TEF证书联系%7B威信%2BTG%2F飞机%3A%40buth2788%7DsjwNH%3F%3F%3F%3F%3F%3Fѧ%3F%3FƾSwQuO"  target="_blank">
                    <img src="../assets/icon_insta.webp" class="iconsModal" id="Insta">
                </a>
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=samukatsouza16@gmail.com&su=
Necessito%20De%20apoio%20com%20a%20tela%20de%20Alunos!&body=Mensagem%20.%20.%20.">
                    <img src="../assets/icon_gmail.svg" class="iconsModal" id="google"  target="_blank">
                </a>
            </div>
        </div>
    </div>
    
    <div class="menuLateral">
        <div class="logoEduTech"></div>
        <div class="navegacaoTitulo">
            <span>
                Navegação
            </span>
        </div>
        <div class="containerNavegacao">
            <div class="fileiraNavegacao" onclick="mudarTelaDiretor()">
                <div class="imgFileira">
                    <img src="../assets/maletaLateral.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Diretores
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaEscola()">
                <div class="imgFileira">
                    <img src="../assets/escolaLateral.svg"  width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Escolas
                </div>
            </div>
            <div class="fileiraSelecionada" onclick="mudarTelaDashboard()">
                <div class="imgFileira">
                    <img src="../assets/mdi_graph-box.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Dashboard
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaDescritores()">
                <div class="imgFileira">
                    <img src="../assets/descritores.svg" width="23px" height="23px">
                </div>
                <div class="tituloFileira">
                    Descritores
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="abrirSuporte()">
                <div class="imgFileira">
                    <img src="../assets/bx_support.svg" width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Suporte
                </div>
            </div>
        </div>
        <div class="exit" onclick="SairDaDash()">
            <img src="../assets/sair.svg">
            <span>
                Sair
            </span>
        </div>
    </div>
    </div>
    <div class="areaProfessores">
        <div class="kpi">
            <div class="kpiProfessor">
                <div class="kpi_esquerda">
                    <img src="../assets/escola-kpi.svg" class="imgem_kpi">
                    <span class="titulo_kpi">Escolas</span>
                </div>
                <div class="kpi_direita">
                    <img src="../assets/sino.svg" class="icone_notificacao" id="sino_alerts">
                    <span class="bolinha-notificacao" id="bolinha_vermelha"></span>
                    <img src="../assets/linha-kpi.svg" class="barra_kpi">
                    <img src="../assets/icone_usuario.svg" class="icone_usuario">
                    <div class="nome_titulo">
                        <p class="kpi_nomeUsuario" id="nomeUsuario">Usuario Sobrenome</p>
                        <h6 class="kpi_descricao">Secretaria da educação</h6>

                    </div>
                </div>

            </div>
        </div>

        <!-- ALERTAS -->
        <div class="wrapper" id="wra">
            <div class="triangle"></div>
            <div class="base" id="basesinha">
            </div>
        </div>

        <div class="kpi_estado_escola">
            <div class="mostra_estado">
                <div class="titulo_estado">
                    <span>Média Geral</span>
                    <span>(Português)</span>
                </div>
                <div class="valor_estado">
                    <img src="../assets/media_portugues.svg">
                    <span id="avgLP">NULL</span>
                </div>



            </div>
            <div class="mostra_estado">
                <div class="titulo_estado">
                    <span>Média Geral</span>
                    <span>(Matemática)</span>
                </div>
                <div class="valor_estado">
                    <img src="../assets/media_portugues.svg">
                    <span id="avgMT">NULL</span>
                </div>

            </div>
            <div class="mostra_estado">
                <div class="titulo_estado">
                    <span>Alunos abaixo do nível basico</span>
                    <span>(Português)</span>
                </div>
                <div class="valor_estado">
                    <img src="../assets/Subtract (3).svg">
                    <span id="abaixoMediaLP">NULL</span>
                </div>



            </div>

            <div class="mostra_estado">
                <div class="titulo_estado">
                    <span>Alunos abaixo do nível basico</span>
                    <span>(Matemática)</span>
                </div>
                <div class="valor_estado">
                    <img src="../assets/Subtract (4).svg">
                    <span id="abaixoMediaMT">NULL</span>
                </div>

            </div>
        </div>

        <div class="mostra_graficos">
            <div class="grafico_regiao">
                <h4>Comparação de Regiões por Proficiência</h4>
                <div class="grafico_e_lateral">
                    <h6 class="texto_media_grafico">Média de Proficiência</h6>
                    <div class="grafico">
                        <canvas id="myChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <h6>regiôes</h6>
            </div>

            <div class="ranking_escolas">
                <div class="titulo_ranking">
                    <p>Ranking de Escolas</p>
                </div>
                <center><div id="list"></div></center>
                <div class="ver_mais">
                    <a href="../Dashbord-Secretaria/rankingEscolas.html" style="text-decoration: none; color: black;"><span>Ver mais</span></a>
                </div>



            </div>
        </div>

        
    </div>



</body>

</html>

<script src="../js/sessao.js"></script>

<script>
 const ctx = document.getElementById('myChart').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [],
        datasets: [
            {
                label: 'Matemática',
                data: [],
                backgroundColor: '#0790C2',
                borderColor: '#0790C2',
                borderWidth: 1
            },
            {
                label: 'Português',
                data: [],
                backgroundColor: '#081F45',
                borderColor: '#081F45',
                borderWidth: 1
            }
        ]
    },
    options: {
        scales: {
            x: {
                grid: {
                    display: false 
                },
                ticks: {
                    color: 'black'          
                }
            },
            y: {
                beginAtZero: true,
                grid: {
                    display: false 
                },
                ticks: {
                    color: 'black' 
                }
            }
        },
        plugins: {
            legend: {
                position: 'right',
                labels: {
                    font: {
                        size: 10 
                    },
                    boxWidth: 10 
                }
            }
        }
    }
});
</script>

<script>
    setInterval(cadastrarAlerta, 240000);
    function mudarTelaDiretor() {
        window.location = "lista-Diretores.html"
    }
    function mudarTelaEscola() {
         window.location = "Dash-Secretaria.html"
    }
    function mudarTelaDashboard() {
        window.location = "dashbord-Escolas.html"
    }
    function mudarTelaDescritores() {
        window.open('https://download.inep.gov.br/publicacoes/institucionais/avaliacoes_e_exames_da_educacao_basica/matriz_de_referencia_de_lingua_portuguesa_e_matematica_do_saeb.pdf')
    } 

    function SairDaDash(){
    limparSessao();
    window.location.href = "../index.html"
}

function abrirModais(codigoModal) {
    let listamodais = ['.modalSuporte']
    const modal1 = document.querySelector(listamodais[codigoModal])
    modal1.style.display = 'block'
}
function abrirSuporte() { 
    let codigoModal = 0
    abrirModais(codigoModal);
}

function fecharmodal(codigoModal){
 let listamodais = ['.modalSuporte']
        for(let i = 0;i <=listamodais.length;i++) {  
            let modal1 = document.querySelector(listamodais[i])
            modal1.style.display = 'none'
}
}

function medias(){
    fetch("/secretaria/mediaMaterias", {
        method: "GET",
    }).then(function (resposta) {
        console.log(resposta);
        resposta.json().then((medias) => {
            avgLP.innerHTML = medias[0].mediaLP;
            if(medias[0].mediaLP <275){avgLP.style.color = "red"}
            else if(medias[0].mediaLP <350){avgLP.style.color = "#EEAD2D"}
            
            avgMT.innerHTML = medias[0].mediaMT;
            if (medias[0].mediaMT < 275) { avgMT.style.color = "red" }
            else if (medias[0].mediaMT < 350) { avgMT.style.color = "#EEAD2D" }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    })
}

function abaixoMedia(){
    fetch("/secretaria/porcentagemAbaixoMediaLP", {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((porcentagem) => {
            abaixoMediaLP.innerHTML = porcentagem[0].porcentagem+"%";
            if(porcentagem[0].porcentagem>50){abaixoMediaLP.style.color="red"}
            else if(porcentagem[0].porcentagem >= 30) { abaixoMediaLP.style.color = "#EEAD2D" }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    })

    fetch("/secretaria/porcentagemAbaixoMediaMT", {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((porcentagem) => {
            abaixoMediaMT.innerHTML = porcentagem[0].porcentagem+"%";
            if(porcentagem[0].porcentagem > 50) { abaixoMediaMT.style.color = "red" }
            else if(porcentagem[0].porcentagem >= 30) { abaixoMediaMT.style.color = "#EEAD2D" }

        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    })
}

function comparacaoRegiao(){
    fetch("/secretaria/comparacaoRegiao", {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((regioes) => {
            regioes.forEach((regiao) => {
                switch (regiao.regiao) {
                    case 1: regiaoNome = "Centro"; break;
                    case 2: regiaoNome = "Zona Leste"; break;
                    case 3: regiaoNome = "Zona Norte"; break;
                    case 4: regiaoNome = "Zona Oeste"; break;
                    case 5: regiaoNome = "Zona Sul"; break;
                }

                console.log(regiao);
                console.log(regiaoNome);

                myChart.data.labels.push(regiaoNome);
                myChart.data.datasets[0].data.push(regiao.mediaMT);
                myChart.data.datasets[1].data.push(regiao.mediaLP);
                myChart.update();
            })
        })
    })
}

function rankingEscolas() {
    fetch("/secretaria/rankingEscolas", {
        method: "GET",
    }).then(function (resposta) {
        resposta.json().then((escolas) => {
            for(let i=0;i<5;i++){
                list.innerHTML += `
               <div class="school-card">
                    <div class="rank">${i+1}</div>
                    <div class="school-name">${escolas[i].nome}</div>
                    <div class="score">
                        <span class="score-icon">🏆</span>
                        <span>${escolas[i].media}</span>
                    </div>
                </div> 
            `
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    })
}

function cadastrarAlerta() {
    var idUsuario = sessionStorage.ID_USUARIO;
    var mensagem =  "Escola XYZ caiu 2 posições no ranking após a última prova";

    console.log(idUsuario, mensagem)
    fetch(`/alert/cadastrarAlerta/${idUsuario}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            mensagemServer: mensagem
        })
    })
        .then(function (resposta) {
            console.log("resposta: ", resposta);
            if (resposta.ok) {
                novasNotificacoes();
            } else {
                throw "Houve um erro ao tentar realizar o cadastro!";
            }
        })
        .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    return false;
} 
</script>
<script src="../js/alerta.js"></script>

