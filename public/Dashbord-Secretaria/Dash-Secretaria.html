<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/cssDashSecretaria/inicioSecrretaria.css">
    <link rel="icon" sizes="56X56" href="../assets/a 1logo-Educare.svg">
    <link rel="stylesheet" href="../css/modal.css">
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet'>
    <title>Edu Tech | Dashboard</title>
</head>

<body onload="validarSessao(), escolas()">

    <div class="modalSuporte" onclick="fecharmodal()">
        <div class="contentSuporte">
            <div class="titleSuporte">Meios de contato</div>
            <div class="EspacoModalSuporte"></div>
            <div class="titleSuporte">
                <a href="https://wa.me/+5511914821813" target="_blank">
                    <img src="../assets/Icon-whatsapp.png" class="iconsModal">
                </a>
                <a href="https://www.instagram.com/theodorsouza42/?next=%2Fbluegodzi%2Ftagged%2F&locale=在
                    线定制塔吉克斯坦TEF证书联系%7B威信%2BTG%2F飞机%3A%40buth2788%7DsjwNH%3F%3F%3F%3F%3F%3Fѧ%3F%3FƾSwQuO"
                    target="_blank">
                    <img src="../assets/icon_insta.webp" class="iconsModal" id="Insta">
                </a>
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=samukatsouza16@gmail.com&su=
Necessito%20De%20apoio%20com%20a%20tela%20de%20Alunos!&body=Mensagem%20.%20.%20." target="_blank">
                    <img src="../assets/icon_gmail.svg" class="iconsModal" id="google">
                </a>
            </div>
        </div>
    </div>

    <div class="menuLateral">
        <div class="logoEduTech"></div>
        <div class="navegacaoTitulo">
            <span>
                Navegação
            </span>
        </div>
        <div class="containerNavegacao">
            <div class="fileiraNavegacao" onclick="mudarTelaDiretor()">
                <div class="imgFileira">
                    <img src="../assets/maletaLateral.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Diretores
                </div>
            </div>
            <div class="fileiraSelecionada" onclick="mudarTelaEscola()">
                <div class="imgFileira">
                    <img src="../assets/escolaLateral.svg" width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Escolas
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaDashboard()">
                <div class="imgFileira">
                    <img src="../assets/mdi_graph-box.svg" width="28px" height="28px">
                </div>
                <div class="tituloFileira">
                    Dashboard
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="mudarTelaDescritores()">
                <div class="imgFileira">
                    <img src="../assets/descritores.svg" width="23px" height="23px">
                </div>
                <div class="tituloFileira">
                    Descritores
                </div>
            </div>
            <div class="fileiraNavegacao" onclick="abrirSuporte()">
                <div class="imgFileira">
                    <img src="../assets/bx_support.svg" width="30px" height="30px">
                </div>
                <div class="tituloFileira">
                    Suporte
                </div>
            </div>
        </div>
        <div class="exit" onclick="SairDaDash()">
            <img src="../assets/sair.svg">
            <span>
                Sair
            </span>
        </div>
    </div>
    </div>
    <div class="areaProfessores">
        <div class="kpi">
            <div class="kpiProfessor">
                <div class="kpi_esquerda">
                    <img src="../assets/escola-kpi.svg" class="imgem_kpi">
                    <span class="titulo_kpi">Escolas</span>
                </div>
                <div class="kpi_direita">
                    <img src="../assets/sino.svg" class="icone_notificacao" id="sino_alerts">
                    <img src="../assets/linha-kpi.svg" class="barra_kpi">
                    <img src="../assets/icone_usuario.svg" class="icone_usuario">
                    <div class="nome_titulo">
                        <p class="kpi_nomeUsuario" id="nomeUsuario">Usuario Sobrenome</p>
                        <h6 class="kpi_descricao">Secretaria da educação</h6>


                    </div>
                </div>

            </div>
        </div>

        <!-- ALERTAS -->
        <div class="wrapper" id="wra">
            <div class="triangle"></div>
            <div class="base" id="basesinha">
            </div>
        </div>

        <div class="areaAdicaoPesquisa">
            <div class="pesquisa">
                <div class="tituloPesquisar">
                    <span>
                        Pesquisar
                    </span>
                </div>
                <div class="barras">
                    <div class="barraPesquisa">
                        <input class="inputPesquisa" id="pesquisaInput">
                        <button class="botao_pesquisar" onclick="pesquisa()"><img src="../assets/lupa_pesquisar.svg"
                                alt=""></button>
                    </div>
                    <div class="filtro">
                        <select id="filtro" class="inputFiltro" onchange="escolasFiltro()">
                            <option value="0">Filtrar: Região</option>
                            <option value="1">Filtrar: Centro</option>
                            <option value="2">Filtrar: Zona Leste</option>
                            <option value="3">Filtrar: Zona Norte</option>
                            <option value="4">Filtrar: Zona Oeste</option>
                            <option value="5">Filtrar: Zona Sul</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="adicionar">
                <!-- <button class="btnAdicionar">
                    Importar
                </button> -->
                <button class="btnAdicionar" style="margin-right: 10%;" onclick="mudaTelaCadastro()">
                    Adicionar
                </button>
            </div>
        </div>
        <div class="cards_escolas" id="cards_escolas"></div>

    </div>
    </div>
    <dialog close id="modalExcluir" class="modal_editar">
        <div class="div_modal_container, div_container2">
            <div class="div_edicao">Confirmar Exclusão</div>
            <span id="textoModalExcluir" class="div_modal_titulo">Tem certeza que deseja excluir essa escola?</span><br>
            <span style="color: red; margin-bottom: 1vw;">(Isso excluirá tudo associado a essa escola)</span>

            <div style="display: flex; justify-content: end; gap: 10px; margin: 5px 5px;" class="div_botao">
                <button id="cancelarExcluir" onclick="cancelarExcluir()" class="bt_modal">Cancelar</button>
                <button id="confirmarExcluir" onclick="confirmarExcluir()" class="bt_modal">Excluir</button>
            </div>
        </div>
    </dialog>
</body>

</html>

<script src="../js/sessao.js"></script>

<script>
    function mudarTelaDiretor() {
        window.location = "lista-Diretores.html"
    }
    function mudarTelaEscola() {
        window.location = "Dash-Secretaria.html"
    }
    function mudarTelaDashboard() {
        window.location = "dashbord-Escolas.html"
    }
    function mudarTelaDescritores() {
        window.open('https://download.inep.gov.br/publicacoes/institucionais/avaliacoes_e_exames_da_educacao_basica/matriz_de_referencia_de_lingua_portuguesa_e_matematica_do_saeb.pdf')
    }
    function mudaTelaCadastro() {
        window.location = "cadastro-Escolas.html"
    }

    function SairDaDash() {
        limparSessao();
        window.location.href = "../index.html"
    }

    function abrirModais(codigoModal) {
        let listamodais = ['.modalSuporte']
        const modal1 = document.querySelector(listamodais[codigoModal])
        modal1.style.display = 'block'
    }
    function abrirSuporte() {
        let codigoModal = 0
        abrirModais(codigoModal);
    }

    function fecharmodal(codigoModal) {
        let listamodais = ['.modalSuporte']
        for (let i = 0; i <= listamodais.length; i++) {
            let modal1 = document.querySelector(listamodais[i])
            modal1.style.display = 'none'
        }
    }


    function escolas() {
        fetch("/secretaria/escolas", {
            method: "GET",
        }).then(function (resposta) {
            resposta.json().then((escolas) => {
                escolas.forEach((escola) => {
                    switch (escola.idRegiao) {
                        case 1: regiao = "Centro"; break;
                        case 2: regiao = "Zona Leste"; break;
                        case 3: regiao = "Zona Norte"; break;
                        case 4: regiao = "Zona Oeste"; break;
                        case 5: regiao = "Zona Sul"; break;
                    }

                    let nomeDiretor = escola.diretor;

                    if (nomeDiretor == null) {
                        nomeDiretor = "Sem dados"
                    }

                    cards_escolas.innerHTML += `
                <div class="cards">
                <div class="foto_escola"><img src="../assets/icone_escola_card.svg" alt=""></div>
                <div class="nome_escola">
                    <h2>${escola.escola}</h2>
                </div>
                <div class="diretor_escola"><span>Diretor: ${nomeDiretor}</div></span>
                <div class="regiao_escola">
                    <img src="../assets/icone_localização.svg">
                    <span>Região:
                        <span>
                            ${regiao}
                        </span>
                    </span>
                </div>
                <div class="media_escola">
                    <img src="../assets/media_icone.svg">
                    <span>Média:
                        <span>
                        ${escola.media}
                        </span>
                    </span>
                </div>
                <div class="editarExcluir">
                    <span onclick="edit(${escola.idEscola})">Editar&nbsp;</span>
                    <span>|</span>
                    <span onclick="excluirModal(${escola.idEscola})">&nbsp;Excluir</span>
                </div>
            </div>
            `
                })
            })
        })
    }

    function pesquisa() {
        let pesquisaVar = pesquisaInput.value;
        if (pesquisaVar.trim() != "") {
            cards_escolas.innerHTML = "";
            fetch("/secretaria/escolasPesquisa/" + pesquisaVar, {
                method: "GET",
            }).then(function (resposta) {
                resposta.json().then((escolas) => {
                    escolas.forEach((escola) => {
                        switch (escola.idRegiao) {
                            case 1: regiao = "Centro"; break;
                            case 2: regiao = "Zona Leste"; break;
                            case 3: regiao = "Zona Norte"; break;
                            case 4: regiao = "Zona Oeste"; break;
                            case 5: regiao = "Zona Sul"; break;
                        }

                        let nomeDiretor = escola.diretor;

                        if (nomeDiretor == null) {
                            nomeDiretor = "Sem dados"
                        }

                        cards_escolas.innerHTML += `
                <div class="cards">
                <div class="foto_escola"><img src="../assets/icone_escola_card.svg" alt=""></div>
                <div class="nome_escola">
                    <h2>${escola.escola}</h2>
                </div>
                <div class="diretor_escola"><span>Diretor: ${nomeDiretor}</div></span>
                <div class="regiao_escola">
                    <img src="../assets/icone_localização.svg">
                    <span>Região:
                        <span>
                            ${regiao}
                        </span>
                    </span>
                </div>
                <div class="media_escola">
                    <img src="../assets/media_icone.svg">
                    <span>Média:
                        <span>
                        ${escola.media}
                        </span>
                    </span>
                </div>
                <div class="editarExcluir">
                    <span onclick="edit(${escola.idEscola})">Editar&nbsp;</span>
                    <span>|</span>
                    <span onclick="excluirModal(${escola.idEscola})">&nbsp;Excluir</span>
                </div>
            </div>
            `
                    })
                })
            })
        } else {
            cards_escolas.innerHTML = "";
            escolas();
        }
    }

    function escolasFiltro() {
        let regiao = filtro.value;
        if (regiao != 0) {
            cards_escolas.innerHTML = "";
            fetch("/secretaria/escolasFiltro/" + regiao, {
                method: "GET",
            }).then(function (resposta) {
                resposta.json().then((escolas) => {
                    escolas.forEach((escola) => {
                        switch (escola.idRegiao) {
                            case 1: regiao = "Centro"; break;
                            case 2: regiao = "Zona Leste"; break;
                            case 3: regiao = "Zona Norte"; break;
                            case 4: regiao = "Zona Oeste"; break;
                            case 5: regiao = "Zona Sul"; break;
                        }

                        let nomeDiretor = escola.diretor;

                        if (nomeDiretor == null) {
                            nomeDiretor = "Sem dados"
                        }

                        cards_escolas.innerHTML += `
                <div class="cards">
                <div class="foto_escola"><img src="../assets/icone_escola_card.svg" alt=""></div>
                <div class="nome_escola">
                    <h2>${escola.escola}</h2>
                </div>
                <div class="diretor_escola"><span>Diretor: ${nomeDiretor}</div></span>
                <div class="regiao_escola">
                    <img src="../assets/icone_localização.svg">
                    <span>Região:
                        <span>
                            ${regiao}
                        </span>
                    </span>
                </div>
                <div class="media_escola">
                    <img src="../assets/media_icone.svg">
                    <span>Média:
                        <span>
                        ${escola.media}
                        </span>
                    </span>
                </div>
                <div class="editarExcluir">
                    <span onclick="edit(${escola.idEscola})">Editar&nbsp;</span>
                    <span>|</span>
                    <span onclick="excluirModal(${escola.idEscola})">&nbsp;Excluir</span>
                </div>
            </div>
            `
                    })
                })
            })
        } else {
            cards_escolas.innerHTML = "";
            escolas();
        }
    }

    function edit(idEscola) {
        window.location.href = "editarEscola.html?idEscola=" + idEscola
    }

    function excluirModal(idEscola) {
        modalExcluir.showModal();
        modalExcluir.value = idEscola;
    }

    function cancelarExcluir() {
        modalExcluir.close();
    }

    function confirmarExcluir(idEscola) {
        modalExcluir.innerHTML = `<span>Insira sua senha para confirmar</span><br><input id='senhaConfirmar' type='password'><button onclick='excluir(${modalExcluir.value})'>Confirmar</button>`
    }

    function excluir(idEscola) {
        let senha = senhaConfirmar.value;

        fetch(`/secretaria/confirmarOperacao/${sessionStorage.ID_USUARIO}/${senha}`, {
            method: "GET",
        }).then(function (resposta) {
            if (resposta.ok) {
                fetch(`/secretaria/excluirEscola/${idEscola}`, {
                    method: "DELETE",
                }).then(function (resposta) {
                    if (resposta.ok) {
                        alert("Escola removida com sucesso!");
                        mudarTelaEscola();
                    }
                });
            } else {
                alert("Falha em validar usuário.")
            }
        });
    }

</script>

<script src="../js/alerta.js"></script>